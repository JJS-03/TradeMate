
@baseUrl = http://localhost:8080
@email = seller1@test.com
@password = 12345678
@otherEmail = buyer1@test.com
@otherPassword = 12345678
@testEmail = buyer2@test.com
@testPassword = 12345678
# 로그인 후 발급된 token(eyJ...)을 아래에 붙여넣으세요. (Bearer 제외)
@accessToken = eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiI2IiwiZW1haWwiOiJzZWxsZXIxQHRlc3QuY29tIiwiaWF0IjoxNzcyMTc1MTg1LCJleHAiOjE3NzIxNzg3ODV9.h0q6Fji1cgxCOiWV0g3Vpd5nCwH5NEq1ZAS1YoLMDjljsIsXMD1rpP_QYkn9zFQs
@otherAccessToken = eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiI3IiwiZW1haWwiOiJidXllcjFAdGVzdC5jb20iLCJpYXQiOjE3NzIxNzUyMDQsImV4cCI6MTc3MjE3ODgwNH0.y3FJi7bKD34TAhXhX-VfEeT_RZjIwXo92zBVwGG3wQ3AD_NqaAoY_dKMUDCfwqOy
# 반드시 seller1이 아닌 다른 계정의 토큰을 넣으세요. (같은 계정 토큰이면 7번도 200)
@existingItemId = 18
# 5-1 응답의 id 값을 아래 existingItemId에 수동으로 넣어주세요 (미설정 시 6,7도 404)
@notFoundItemId = 999999
@purchaseItemId = 55
@completeTradeId = 39
@cancelTradeId = 39

### 0) 회원가입 (최초 1회만 실행)
### 이미 가입된 이메일이면 409(DUPLICATE_EMAIL)가 정상입니다.
POST {{baseUrl}}/api/users/signup
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}",
  "nickname": "seller1"
}

### 1) 로그인 (판매자 항상 이 요청으로 토큰 재발급)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}"
}

### 1-1) 다른 유저 회원가입 (403 테스트용, 최초 1회)
POST {{baseUrl}}/api/users/signup
Content-Type: application/json

{
  "email": "{{otherEmail}}",
  "password": "{{otherPassword}}",
  "nickname": "buyer1"
}

### 1-2) 다른 유저 로그인 (otherAccessToken 수동 갱신)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{otherEmail}}",
  "password": "{{otherPassword}}"
}

### 1-1) 다른 유저 회원가입 (동시성 구매자 테스트용, 최초 1회)
POST {{baseUrl}}/api/users/signup
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}",
  "nickname": "buyer2"
}
### 1) 다른 유저 로그인 (동시성 제어 구매자2)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{testEmail}}",
  "password": "{{testPassword}}"
}

### 응답 token 값을 @otherAccessToken에 붙여넣으세요.

### 2) 상품 등록 (정상: 201)
### 주의: accessToken에는 Bearer 없이 '토큰 문자열만' 저장되어야 함
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}
# 만약 여전히 401이면 로그인 응답의 token(eyJ...)만 복사해 아래 Authorization 헤더의 {{accessToken}} 값으로 사용

{
  "title": "아이폰 14",
  "description": "거의 새 상품입니다.",
  "price": 900000
}

### 3) 상품 등록 (Authorization 누락: 401)
POST {{baseUrl}}/api/items
Content-Type: application/json

{
  "title": "맥북 프로",
  "description": "M1 16인치",
  "price": 1800000
}

### 4) 상품 등록 (title 공백: 400)
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}
# 만약 여전히 401이면 로그인 응답의 token(eyJ...)만 복사해 아래 Authorization 헤더의 {{accessToken}} 값으로 사용

{
  "title": "",
  "description": "제목 누락 테스트",
  "price": 10000
}

### 5-1) 상품 등록 (수정 테스트용 ID 확보: 201)
# @name createItemForUpdate
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "수정 테스트 원본",
  "description": "수정 전 설명",
  "price": 500000
}


### 6) 상품 수정 (정상: 200)
# 5-1 실행 후 응답의 id를 existingItemId에 넣고 실행하세요.
# (REST Client 확장 지원 시: {{createItemForUpdate.response.body.id}} 사용 가능)
PUT {{baseUrl}}/api/items/{{existingItemId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "아이폰 14 Pro",
  "description": "수정된 설명입니다.",
  "price": 950000
}

### 7) 상품 수정 (다른 유저: 403)
# otherAccessToken에 seller와 다른 계정 토큰을 넣어야 403이 나옵니다. (같은 토큰이면 200)
PUT {{baseUrl}}/api/items/{{existingItemId}}
Content-Type: application/json
Authorization: Bearer {{otherAccessToken}}

{
  "title": "권한 없는 수정",
  "description": "다른 유저 수정 시도",
  "price": 100000
}

### 8) 상품 수정 (존재하지 않는 상품: 404)
PUT {{baseUrl}}/api/items/{{notFoundItemId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "없는 상품 수정",
  "description": "404 테스트",
  "price": 100000
}

### 9) 상품 삭제 (정상: 204)
DELETE {{baseUrl}}/api/items/{{existingItemId}}
Authorization: Bearer {{accessToken}}

### 10) 상품 삭제 (다른 유저: 403)
DELETE {{baseUrl}}/api/items/{{existingItemId}}
Authorization: Bearer {{otherAccessToken}}

### 11) 상품 삭제 (존재하지 않는 상품: 404)
DELETE {{baseUrl}}/api/items/{{notFoundItemId}}
Authorization: Bearer {{accessToken}}

Authorization: Bearer {{accessToken}}

### 12) 상태 변경 준비용 상품 등록 (정상: 201)
# @name createItemForStatusChange
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "상태 변경 테스트 상품",
  "description": "SELLING -> RESERVED -> SOLD 테스트",
  "price": 700000
}

### 13) 상태 변경 (SELLING -> RESERVED, 정상: 200)
# createItemForStatusChange 응답 id를 existingItemId에 넣거나 {{createItemForStatusChange.response.body.id}} 사용
PATCH {{baseUrl}}/api/items/{{existingItemId}}/status
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "RESERVED"
}

### 14) 상태 변경 (RESERVED -> SOLD, 정상: 200)
PATCH {{baseUrl}}/api/items/{{existingItemId}}/status
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "SOLD"
}

### 15) 상태 변경 (SOLD -> RESERVED 시도, 실패: 400)
PATCH {{baseUrl}}/api/items/{{existingItemId}}/status
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "status": "RESERVED"
}

### 16) 상태 변경 (다른 유저 시도, 실패: 403)
# 별도 SELLING 상태 상품으로 테스트해야 합니다. (이미 SOLD인 상품이면 400이 먼저 발생)
PATCH {{baseUrl}}/api/items/{{existingItemId}}/status
Content-Type: application/json
Authorization: Bearer {{otherAccessToken}}

{
  "status": "RESERVED"
}


### 17) 구매 테스트용 상품 등록 (정상: 201)
# @name createItemForPurchase
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "구매 테스트 상품",
  "description": "구매 API 검증용",
  "price": 350000
}

### 18) 정상 구매 (정상: 201)
# @name purchaseTrade
# createItemForPurchase 응답 id를 purchaseItemId에 넣거나 {{createItemForPurchase.response.body.id}} 사용
# 응답 예시: {"id": 123, "itemId": ..., "status": "RESERVED", ...}  -> 여기서 id가 trade id
POST {{baseUrl}}/api/items/{{purchaseItemId}}/purchase
Authorization: Bearer {{otherAccessToken}}

### 19) 이미 RESERVED 상품 재구매 시도 (실패: 400)
POST {{baseUrl}}/api/items/{{purchaseItemId}}/purchase
Authorization: Bearer {{otherAccessToken}}

### 20) 자기 상품 구매 시도용 상품 등록 (정상: 201)
# @name createItemForSelfPurchase
POST {{baseUrl}}/api/items
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "자기 구매 시도 상품",
  "description": "본인 상품 구매 불가 검증",
  "price": 120000
}

### 21) 자기 상품 구매 시도 (실패: 400)
# createItemForSelfPurchase 응답 id를 purchaseItemId에 넣거나 {{createItemForSelfPurchase.response.body.id}} 사용
POST {{baseUrl}}/api/items/{{purchaseItemId}}/purchase
Authorization: Bearer {{accessToken}}

### 22) 존재하지 않는 상품 구매 시도 (실패: 404)
POST {{baseUrl}}/api/items/{{notFoundItemId}}/purchase
Authorization: Bearer {{otherAccessToken}}

### 23) 거래 완료 (정상: 200)
# 방법1) 위 18번(@name purchaseTrade) 응답 id를 completeTradeId에 넣어서 요청
# 방법2) REST Client 지원 시 아래처럼 바로 사용: /api/trades/{{purchaseTrade.response.body.id}}/complete
POST {{baseUrl}}/api/trades/{{completeTradeId}}/complete
Authorization: Bearer {{accessToken}}

### 24) 구매자가 거래 완료 시도 (실패: 403)
POST {{baseUrl}}/api/trades/{{completeTradeId}}/complete
Authorization: Bearer {{otherAccessToken}}

### 25) 이미 완료된 거래 완료 재시도 (실패: 400)
POST {{baseUrl}}/api/trades/{{completeTradeId}}/complete
Authorization: Bearer {{accessToken}}

### 26) 존재하지 않는 거래 완료 시도 (실패: 404)
POST {{baseUrl}}/api/trades/{{notFoundItemId}}/complete
Authorization: Bearer {{accessToken}}

### 27) 거래 취소 (정상: 200)
# cancelTradeId는 RESERVED 상태의 거래 id여야 합니다.
POST {{baseUrl}}/api/trades/{{cancelTradeId}}/cancel
Authorization: Bearer {{otherAccessToken}}

### 28) 판매자가 거래 취소 시도 (실패: 403)
POST {{baseUrl}}/api/trades/{{cancelTradeId}}/cancel
Authorization: Bearer {{accessToken}}

### 29) 이미 COMPLETED 상태 거래 취소 시도 (실패: 400)
POST {{baseUrl}}/api/trades/{{completeTradeId}}/cancel
Authorization: Bearer {{otherAccessToken}}

### 30) 존재하지 않는 거래 취소 시도 (실패: 404)
POST {{baseUrl}}/api/trades/{{notFoundItemId}}/cancel
Authorization: Bearer {{otherAccessToken}}
